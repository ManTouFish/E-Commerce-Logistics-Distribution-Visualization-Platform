# 配送范围功能调试指南

## 问题描述
点击"圈选配送范围"按钮后，数据库不更新。

## 可能的原因
1. 用户未登录或没有商家信息
2. 数据库中没有测试商家数据
3. 配送范围字段类型不匹配

## 调试步骤

### 1. 检查数据库连接和表结构
执行 `database/check_db.sql` 中的SQL语句，检查：
- shops表结构是否正确
- delivery_range字段是否存在且类型为geometry(Polygon, 4326)
- 是否有测试数据

### 2. 创建测试数据
执行 `database/seeds/test_merchant.sql` 中的SQL语句，创建测试商家数据。

### 3. 使用调试工具
访问 `http://localhost:5173/debug/delivery-range` 使用调试工具：
1. 点击"测试登录"按钮，使用测试账号登录
2. 点击"获取商家信息"按钮，检查商家信息是否正确
3. 在"配送范围"输入框中输入WKT格式的多边形数据
4. 点击"更新配送范围"按钮，检查是否更新成功

### 4. 使用测试登录页面
访问 `http://localhost:5173/test-login` 使用测试登录页面：
1. 输入测试账号信息登录
2. 登录成功后跳转到商家页面
3. 在商家页面测试"圈选配送范围"功能

### 5. 检查浏览器控制台
打开浏览器开发者工具，查看控制台输出：
- 检查是否有错误信息
- 查看我们添加的调试日志
- 确认API请求是否成功发送

### 6. 检查网络请求
在开发者工具的"网络"选项卡中：
- 查看updateShopDeliveryRange请求是否发送
- 检查请求参数是否正确
- 查看响应状态和内容

## 测试账号信息
- 邮箱: merchant@test.com
- 密码: test123456
- 商家ID: 11111111-1111-1111-1111-111111111111
- 用户ID: 00000000-0000-0000-0000-000000000001

## WKT格式示例
```
SRID=4326;POLYGON((116.3 39.9, 116.4 39.9, 116.4 40.0, 116.3 40.0, 116.3 39.9))
```

## 常见问题及解决方案

### 问题1: 用户未登录
**解决方案**: 使用测试登录页面或调试工具中的"测试登录"按钮登录。

### 问题2: 没有商家信息
**解决方案**: 执行 `database/seeds/test_merchant.sql` 创建测试商家数据。

### 问题3: 配送范围字段类型不匹配
**解决方案**: 确保delivery_range字段类型为geometry(Polygon, 4326)，并使用WKT格式更新。

### 问题4: 权限问题
**解决方案**: 检查Supabase RLS策略，确保用户可以更新自己的商家信息。

## 联系方式
如果问题仍然存在，请提供以下信息：
1. 浏览器控制台的错误信息
2. 网络请求的详细信息
3. 数据库表结构和数据
4. 具体操作步骤和预期结果